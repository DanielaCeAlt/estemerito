{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danie/OneDrive/Documentos/GostCAM%20-%202111%20-%20copia/GostCAM%20-%20Frontend/src/lib/database.ts"],"sourcesContent":["// =============================================\r\n// CONFIGURACIÓN DE BASE DE DATOS MYSQL\r\n// =============================================\r\n\r\nimport mysql from 'mysql2/promise';\r\nimport { VistaEquipoCompleto, VistaMovimientoDetallado } from '@/types/database';\r\n\r\n// Configuración de la conexión a la base de datos\r\nconst dbConfig = {\r\n  host: process.env.DB_HOST || 'localhost',\r\n  port: parseInt(process.env.DB_PORT || '3306'),\r\n  user: process.env.DB_USER || 'root',\r\n  password: process.env.DB_PASSWORD || '',\r\n  database: process.env.DB_NAME || 'GostCAM',\r\n  charset: 'utf8mb4',\r\n  timezone: '+00:00',\r\n};\r\n\r\n// Pool de conexiones para mejor performance\r\nconst pool = mysql.createPool({\r\n  ...dbConfig,\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  queueLimit: 0,\r\n});\r\n\r\n// Función para obtener una conexión del pool\r\nexport const getConnection = async () => {\r\n  try {\r\n    const connection = await pool.getConnection();\r\n    return connection;\r\n  } catch (error) {\r\n    console.error('Error connecting to the database:', error);\r\n    throw new Error('Failed to connect to database');\r\n  }\r\n};\r\n\r\n// Función para ejecutar queries con manejo de errores\r\nexport const executeQuery = async <T = Record<string, unknown>>(\r\n  query: string,\r\n  params: (string | number | Date | null | undefined)[] = []\r\n): Promise<T[]> => {\r\n  let connection;\r\n  try {\r\n    connection = await getConnection();\r\n    const [rows] = await connection.execute(query, params);\r\n    return rows as T[];\r\n  } catch (error) {\r\n    console.error('Database query error:', error);\r\n    console.error('Query:', query);\r\n    console.error('Params:', params);\r\n    throw error;\r\n  } finally {\r\n    if (connection) {\r\n      connection.release();\r\n    }\r\n  }\r\n};\r\n\r\n// Función para ejecutar procedimientos almacenados\r\nexport const callStoredProcedure = async <T = Record<string, unknown>>(\r\n  procedureName: string,\r\n  params: (string | number | Date | null | undefined)[] = []\r\n): Promise<T[]> => {\r\n  const placeholders = params.map(() => '?').join(', ');\r\n  const query = `CALL ${procedureName}(${placeholders})`;\r\n  \r\n  let connection;\r\n  try {\r\n    connection = await getConnection();\r\n    const [rows] = await connection.execute(query, params);\r\n    // Los procedimientos almacenados devuelven arrays anidados\r\n    return Array.isArray(rows) && Array.isArray(rows[0]) ? rows[0] as T[] : rows as T[];\r\n  } catch (error) {\r\n    console.error('Stored procedure error:', error);\r\n    console.error('Procedure:', procedureName);\r\n    console.error('Params:', params);\r\n    throw error;\r\n  } finally {\r\n    if (connection) {\r\n      connection.release();\r\n    }\r\n  }\r\n};\r\n\r\n// Función para verificar la conexión a la base de datos\r\nexport const testConnection = async (): Promise<boolean> => {\r\n  try {\r\n    const result = await executeQuery('SELECT 1 as test');\r\n    return result.length > 0;\r\n  } catch (error) {\r\n    console.error('Database connection test failed:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Función para cerrar el pool de conexiones\r\nexport const closePool = async (): Promise<void> => {\r\n  try {\r\n    await pool.end();\r\n    console.log('Database pool closed');\r\n  } catch (error) {\r\n    console.error('Error closing database pool:', error);\r\n  }\r\n};\r\n\r\n// Funciones específicas para las vistas de GostCAM\r\nexport const getEquiposCompletos = async (filters?: {\r\n  sucursal?: string;\r\n  tipoEquipo?: string;\r\n  estatus?: string;\r\n  usuario?: string;\r\n  busqueda?: string;\r\n}): Promise<VistaEquipoCompleto[]> => {\r\n  // Usar directamente la tabla equipo con una consulta simple\r\n  return await getEquiposFromTable(filters);\r\n};\r\n\r\n// Función fallback para consultar tabla equipos directamente\r\nconst getEquiposFromTable = async (filters?: {\r\n  sucursal?: string;\r\n  tipoEquipo?: string;\r\n  estatus?: string;\r\n  usuario?: string;\r\n  busqueda?: string;\r\n}): Promise<VistaEquipoCompleto[]> => {\r\n  let query = `\r\n    SELECT \r\n      e.no_serie,\r\n      e.nombreEquipo,\r\n      e.numeroActivo,\r\n      e.modelo,\r\n      e.fechaAlta,\r\n      e.idPosicion,\r\n      te.nombreTipo as TipoEquipo,\r\n      ee.estatus as EstatusEquipo,\r\n      COALESCE(s.Sucursal, 'Centro Principal') as SucursalActual,\r\n      u.NombreUsuario as UsuarioAsignado\r\n    FROM equipo e\r\n    LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo\r\n    LEFT JOIN estatusequipo ee ON e.idEstatus = ee.idEstatus\r\n    LEFT JOIN usuarios u ON e.idUsuarios = u.idUsuarios\r\n    LEFT JOIN posicionequipo pe ON e.idPosicion = pe.idPosicion\r\n    LEFT JOIN sucursales s ON pe.idCentro = s.idCentro\r\n  `;\r\n  \r\n  const params: (string | number | Date | null | undefined)[] = [];\r\n  const conditions: string[] = [];\r\n\r\n  // ✅ Filtrar equipos eliminados lógicamente\r\n  conditions.push('(e.eliminado IS NULL OR e.eliminado = 0)');\r\n\r\n  if (filters) {\r\n    if (filters.tipoEquipo) {\r\n      conditions.push('te.nombreTipo = ?');\r\n      params.push(filters.tipoEquipo);\r\n    }\r\n    if (filters.estatus) {\r\n      conditions.push('ee.estatus = ?');\r\n      params.push(filters.estatus);\r\n    }\r\n    if (filters.sucursal) {\r\n      conditions.push('s.Sucursal = ?');\r\n      params.push(filters.sucursal);\r\n    }\r\n    if (filters.usuario) {\r\n      conditions.push('u.NombreUsuario LIKE ?');\r\n      params.push(`%${filters.usuario}%`);\r\n    }\r\n    if (filters.busqueda) {\r\n      // Búsqueda global en todos los campos principales (función fallback)\r\n      conditions.push(`(\r\n        e.nombreEquipo LIKE ? OR \r\n        e.no_serie LIKE ? OR \r\n        e.numeroActivo LIKE ? OR\r\n        e.modelo LIKE ? OR\r\n        te.nombreTipo LIKE ? OR\r\n        ee.estatus LIKE ? OR\r\n        s.Sucursal LIKE ? OR\r\n        u.NombreUsuario LIKE ?\r\n      )`);\r\n      // Repetir el término de búsqueda para cada campo\r\n      const termino = `%${filters.busqueda}%`;\r\n      params.push(termino, termino, termino, termino, termino, termino, termino, termino);\r\n    }\r\n  }\r\n\r\n  if (conditions.length > 0) {\r\n    query += ' WHERE ' + conditions.join(' AND ');\r\n  }\r\n\r\n  query += ' ORDER BY e.fechaAlta DESC';\r\n\r\n  const result = await executeQuery<VistaEquipoCompleto>(query, params);\r\n  \r\n  return result;\r\n};\r\n\r\nexport const getMovimientosDetallados = async (filters?: {\r\n  sucursalOrigen?: string;\r\n  sucursalDestino?: string;\r\n  tipoMovimiento?: string;\r\n  estatusMovimiento?: string;\r\n  fechaDesde?: string;\r\n  fechaHasta?: string;\r\n}): Promise<VistaMovimientoDetallado[]> => {\r\n  let query = 'SELECT * FROM VistaMovimientosDetallados';\r\n  const params: (string | number | Date | null | undefined)[] = [];\r\n  const conditions: string[] = [];\r\n\r\n  if (filters) {\r\n    if (filters.sucursalOrigen) {\r\n      conditions.push('SucursalOrigen = ?');\r\n      params.push(filters.sucursalOrigen);\r\n    }\r\n    if (filters.sucursalDestino) {\r\n      conditions.push('SucursalDestino = ?');\r\n      params.push(filters.sucursalDestino);\r\n    }\r\n    if (filters.tipoMovimiento) {\r\n      conditions.push('tipoMovimiento = ?');\r\n      params.push(filters.tipoMovimiento);\r\n    }\r\n    if (filters.estatusMovimiento) {\r\n      conditions.push('estatusMovimiento = ?');\r\n      params.push(filters.estatusMovimiento);\r\n    }\r\n    if (filters.fechaDesde) {\r\n      conditions.push('fecha >= ?');\r\n      params.push(filters.fechaDesde);\r\n    }\r\n    if (filters.fechaHasta) {\r\n      conditions.push('fecha <= ?');\r\n      params.push(filters.fechaHasta);\r\n    }\r\n  }\r\n\r\n  if (conditions.length > 0) {\r\n    query += ' WHERE ' + conditions.join(' AND ');\r\n  }\r\n\r\n  query += ' ORDER BY fecha DESC';\r\n\r\n  return executeQuery<VistaMovimientoDetallado>(query, params);\r\n};\r\n\r\nexport const getInventarioPorEstatus = async () => {\r\n  return executeQuery('SELECT * FROM VistaInventarioPorEstatus ORDER BY estatus, TipoEquipo');\r\n};\r\n\r\n// Función para obtener todos los catálogos del sistema\r\nexport const getCatalogos = async () => {\r\n  try {\r\n    console.log('Obteniendo catálogos...');\r\n    \r\n    // Función auxiliar para ejecutar consultas con fallback\r\n    const executeWithFallback = async (query: string, fallback: any[] = []) => {\r\n      try {\r\n        return await executeQuery(query);\r\n      } catch (error) {\r\n        console.warn(`Query failed: ${query}`, error);\r\n        return fallback;\r\n      }\r\n    };\r\n\r\n    // Obtener catálogos básicos que probablemente existan\r\n    const usuarios = await executeWithFallback('SELECT * FROM usuarios', []);\r\n    \r\n    // Para tipos de equipo, intentar múltiples variantes\r\n    const tiposEquipo = await executeWithFallback('SELECT * FROM tipoequipo', []);\r\n    \r\n    // Para estatus, intentar múltiples variantes  \r\n    const estatusEquipos = await executeWithFallback('SELECT * FROM estatusequipo', []);\r\n    \r\n    // Para posiciones, usar valores por defecto si no existe\r\n    const posiciones = await executeWithFallback('SELECT * FROM posiciones', [\r\n      { id: 1, nombre: 'Entrada Principal' },\r\n      { id: 2, nombre: 'Recepción' },\r\n      { id: 3, nombre: 'Oficina' }\r\n    ]);\r\n\r\n    // Para sucursales, intentar obtener de la tabla de equipos o crear por defecto\r\n    const sucursales = await executeWithFallback('SELECT DISTINCT SucursalActual as nombre, SucursalActual as id FROM equipos WHERE SucursalActual IS NOT NULL AND SucursalActual != \"\"', [\r\n      { id: 'SUC001', nombre: 'Sucursal Principal' },\r\n      { id: 'SUC002', nombre: 'Sucursal Norte' },\r\n      { id: 'SUC003', nombre: 'Sucursal Sur' }\r\n    ]);\r\n\r\n    return {\r\n      tiposEquipo,\r\n      estatusEquipos,\r\n      usuarios,\r\n      posiciones,\r\n      sucursales,\r\n      // Catálogos adicionales vacíos por ahora\r\n      estados: [],\r\n      municipios: [],\r\n      zonas: []\r\n    };\r\n  } catch (error) {\r\n    console.error('Error obteniendo catálogos:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const getHistorialMovimientos = async (no_serie?: string) => {\r\n  if (no_serie) {\r\n    return executeQuery('SELECT * FROM VistaHistorialMovimientos WHERE no_serie = ? ORDER BY fecha DESC', [no_serie]);\r\n  }\r\n  return executeQuery('SELECT * FROM VistaHistorialMovimientos ORDER BY fecha DESC LIMIT 100');\r\n};\r\n\r\nexport default pool;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danie/OneDrive/Documentos/GostCAM%20-%202111%20-%20copia/GostCAM%20-%20Frontend/src/app/api/equipos/fallas/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { executeQuery } from '@/lib/database';\r\nimport { ApiResponse } from '@/types/database';\r\n\r\ninterface FallaData {\r\n  id?: number;\r\n  no_serie: string;\r\n  tipo_falla: 'HARDWARE' | 'SOFTWARE' | 'CONECTIVIDAD' | 'SUMINISTROS' | 'MECANICA' | 'ELECTRICA' | 'OTRA';\r\n  descripcion_problema: string;\r\n  sintomas: string;\r\n  prioridad: 'BAJA' | 'NORMAL' | 'ALTA' | 'CRITICA';\r\n  usuario_reporta: string;\r\n  fecha_reporte: string;\r\n  fecha_solucion?: string;\r\n  tecnico_asignado?: string;\r\n  solucion_aplicada?: string;\r\n  estatus: 'ABIERTA' | 'EN_PROCESO' | 'RESUELTA' | 'CANCELADA';\r\n  tiempo_solucion_horas?: number;\r\n  observaciones?: string;\r\n  ubicacion_falla: string;\r\n  impacto: 'BAJO' | 'MEDIO' | 'ALTO' | 'CRITICO';\r\n  requiere_repuestos: boolean;\r\n  repuestos_utilizados?: string;\r\n  costo_reparacion?: number;\r\n}\r\n\r\ninterface FallaResult extends FallaData {\r\n  nombreEquipo: string;\r\n  tipoEquipo: string;\r\n  sucursal: string;\r\n  diasAbierta: number;\r\n}\r\n\r\ninterface EstadisticasFallas {\r\n  total: number;\r\n  abiertas: number;\r\n  en_proceso: number;\r\n  resueltas: number;\r\n  promedio_solucion_horas: number;\r\n  por_tipo: {\r\n    hardware: number;\r\n    software: number;\r\n    conectividad: number;\r\n    suministros: number;\r\n    mecanica: number;\r\n    electrica: number;\r\n    otra: number;\r\n  };\r\n  por_prioridad: {\r\n    baja: number;\r\n    normal: number;\r\n    alta: number;\r\n    critica: number;\r\n  };\r\n  por_tecnico: Array<{\r\n    tecnico: string;\r\n    total_asignadas: number;\r\n    resueltas: number;\r\n    en_proceso: number;\r\n    promedio_horas: number;\r\n  }>;\r\n}\r\n\r\n// GET - Consultar fallas con filtros\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const estatus = searchParams.get('estatus') || 'ABIERTA';\r\n    const prioridad = searchParams.get('prioridad');\r\n    const tipo = searchParams.get('tipo');\r\n    const tecnico = searchParams.get('tecnico');\r\n    const fechaDesde = searchParams.get('fechaDesde');\r\n    const fechaHasta = searchParams.get('fechaHasta');\r\n    const sucursal = searchParams.get('sucursal');\r\n\r\n    // Intentar consulta real primero\r\n    let fallas: FallaResult[] = [];\r\n    \r\n    try {\r\n      // Consulta base con JOIN mejorado\r\n      let query = `\r\n        SELECT \r\n          f.*,\r\n          e.nombreEquipo,\r\n          te.nombreTipo as tipoEquipo,\r\n          COALESCE(s.Sucursal, 'Centro Principal') as sucursal,\r\n          DATEDIFF(NOW(), f.fecha_reporte) as diasAbierta\r\n        FROM fallas_equipos f\r\n        INNER JOIN equipo e ON f.no_serie = e.no_serie\r\n        LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo\r\n        LEFT JOIN posicionequipo pe ON e.idPosicion = pe.idPosicion\r\n        LEFT JOIN sucursales s ON pe.idCentro = s.idCentro\r\n        WHERE 1=1\r\n      `;\r\n\r\n      const params: any[] = [];\r\n\r\n      // Aplicar filtros\r\n      if (estatus) {\r\n        query += ` AND f.estatus = ?`;\r\n        params.push(estatus);\r\n      }\r\n\r\n      if (prioridad) {\r\n        query += ` AND f.prioridad = ?`;\r\n        params.push(prioridad);\r\n      }\r\n\r\n      if (tipo) {\r\n        query += ` AND f.tipo_falla = ?`;\r\n        params.push(tipo);\r\n      }\r\n\r\n      if (tecnico) {\r\n        query += ` AND f.tecnico_asignado LIKE ?`;\r\n        params.push(`%${tecnico}%`);\r\n      }\r\n\r\n      if (fechaDesde) {\r\n        query += ` AND f.fecha_reporte >= ?`;\r\n        params.push(fechaDesde);\r\n      }\r\n\r\n      if (fechaHasta) {\r\n        query += ` AND f.fecha_reporte <= ?`;\r\n        params.push(fechaHasta);\r\n      }\r\n\r\n      if (sucursal) {\r\n        query += ` AND s.Sucursal LIKE ?`;\r\n        params.push(`%${sucursal}%`);\r\n      }\r\n\r\n      query += ` ORDER BY f.fecha_reporte DESC`;\r\n\r\n      fallas = await executeQuery(query, params) as FallaResult[];\r\n      \r\n    } catch (error) {\r\n      console.error('Error consultando fallas BD:', error);\r\n      \r\n      // Si la tabla no existe, devolver array vacío con mensaje claro\r\n      if (error instanceof Error && error.message.includes(\"doesn't exist\")) {\r\n        console.log('⚠️ Tabla fallas_equipos no existe. Crear con script SQL proporcionado.');\r\n        fallas = [];\r\n      } else {\r\n        throw error; // Re-lanzar otros errores\r\n      }\r\n    }\r\n\r\n    // Generar estadísticas\r\n    const estadisticas: EstadisticasFallas = {\r\n      total: fallas.length,\r\n      abiertas: fallas.filter(f => f.estatus === 'ABIERTA').length,\r\n      en_proceso: fallas.filter(f => f.estatus === 'EN_PROCESO').length,\r\n      resueltas: fallas.filter(f => f.estatus === 'RESUELTA').length,\r\n      promedio_solucion_horas: 0,\r\n      por_tipo: {\r\n        hardware: fallas.filter(f => f.tipo_falla === 'HARDWARE').length,\r\n        software: fallas.filter(f => f.tipo_falla === 'SOFTWARE').length,\r\n        conectividad: fallas.filter(f => f.tipo_falla === 'CONECTIVIDAD').length,\r\n        suministros: fallas.filter(f => f.tipo_falla === 'SUMINISTROS').length,\r\n        mecanica: fallas.filter(f => f.tipo_falla === 'MECANICA').length,\r\n        electrica: fallas.filter(f => f.tipo_falla === 'ELECTRICA').length,\r\n        otra: fallas.filter(f => f.tipo_falla === 'OTRA').length,\r\n      },\r\n      por_prioridad: {\r\n        baja: fallas.filter(f => f.prioridad === 'BAJA').length,\r\n        normal: fallas.filter(f => f.prioridad === 'NORMAL').length,\r\n        alta: fallas.filter(f => f.prioridad === 'ALTA').length,\r\n        critica: fallas.filter(f => f.prioridad === 'CRITICA').length,\r\n      },\r\n      por_tecnico: []\r\n    };\r\n\r\n    // Calcular promedio de horas de solución\r\n    const fallasResueltas = fallas.filter(f => f.estatus === 'RESUELTA' && f.tiempo_solucion_horas);\r\n    if (fallasResueltas.length > 0) {\r\n      const totalHoras = fallasResueltas.reduce((sum, f) => sum + (f.tiempo_solucion_horas || 0), 0);\r\n      estadisticas.promedio_solucion_horas = Math.round((totalHoras / fallasResueltas.length) * 100) / 100;\r\n    }\r\n\r\n    // Estadísticas por técnico\r\n    const tecnicosMap = new Map();\r\n    fallas.forEach(falla => {\r\n      if (falla.tecnico_asignado) {\r\n        if (!tecnicosMap.has(falla.tecnico_asignado)) {\r\n          tecnicosMap.set(falla.tecnico_asignado, {\r\n            tecnico: falla.tecnico_asignado,\r\n            total_asignadas: 0,\r\n            resueltas: 0,\r\n            en_proceso: 0,\r\n            total_horas: 0,\r\n            promedio_horas: 0\r\n          });\r\n        }\r\n        \r\n        const tecnico = tecnicosMap.get(falla.tecnico_asignado);\r\n        tecnico.total_asignadas++;\r\n        \r\n        if (falla.estatus === 'RESUELTA') {\r\n          tecnico.resueltas++;\r\n          if (falla.tiempo_solucion_horas) {\r\n            tecnico.total_horas += falla.tiempo_solucion_horas;\r\n          }\r\n        } else if (falla.estatus === 'EN_PROCESO') {\r\n          tecnico.en_proceso++;\r\n        }\r\n      }\r\n    });\r\n\r\n    // Calcular promedios por técnico\r\n    tecnicosMap.forEach(tecnico => {\r\n      if (tecnico.resueltas > 0) {\r\n        tecnico.promedio_horas = Math.round((tecnico.total_horas / tecnico.resueltas) * 100) / 100;\r\n      }\r\n      delete tecnico.total_horas;\r\n    });\r\n\r\n    estadisticas.por_tecnico = Array.from(tecnicosMap.values());\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        fallas,\r\n        estadisticas\r\n      }\r\n    } as ApiResponse<any>);\r\n\r\n  } catch (error) {\r\n    console.error('Error consultando fallas:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      error: 'Error interno del servidor'\r\n    } as ApiResponse<any>, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST - Crear nueva falla\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const {\r\n      no_serie,\r\n      tipo_falla,\r\n      descripcion_problema,\r\n      sintomas,\r\n      prioridad = 'NORMAL',\r\n      usuario_reporta,\r\n      tecnico_asignado,\r\n      ubicacion_falla,\r\n      impacto = 'MEDIO',\r\n      requiere_repuestos = false,\r\n      observaciones = ''\r\n    } = body as FallaData;\r\n\r\n    // Validaciones\r\n    if (!no_serie || !tipo_falla || !descripcion_problema || !usuario_reporta || !ubicacion_falla) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'Campos requeridos: no_serie, tipo_falla, descripcion_problema, usuario_reporta, ubicacion_falla'\r\n      } as ApiResponse<any>, { status: 400 });\r\n    }\r\n\r\n    // Verificar que el equipo existe\r\n    const equipoQuery = `SELECT no_serie, nombreEquipo FROM equipo WHERE no_serie = ?`;\r\n    const equipoResult = await executeQuery(equipoQuery, [no_serie]);\r\n    \r\n    if (equipoResult.length === 0) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'Equipo no encontrado'\r\n      } as ApiResponse<any>, { status: 404 });\r\n    }\r\n\r\n    // Crear tabla si no existe\r\n    const createTableQuery = `\r\n      CREATE TABLE IF NOT EXISTS fallas_equipos (\r\n        id INT AUTO_INCREMENT PRIMARY KEY,\r\n        no_serie VARCHAR(50) NOT NULL,\r\n        tipo_falla ENUM('HARDWARE', 'SOFTWARE', 'CONECTIVIDAD', 'SUMINISTROS', 'MECANICA', 'ELECTRICA', 'OTRA') NOT NULL,\r\n        descripcion_problema TEXT NOT NULL,\r\n        sintomas TEXT,\r\n        prioridad ENUM('BAJA', 'NORMAL', 'ALTA', 'CRITICA') DEFAULT 'NORMAL',\r\n        usuario_reporta VARCHAR(100) NOT NULL,\r\n        fecha_reporte TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n        fecha_solucion TIMESTAMP NULL,\r\n        tecnico_asignado VARCHAR(100),\r\n        solucion_aplicada TEXT,\r\n        estatus ENUM('ABIERTA', 'EN_PROCESO', 'RESUELTA', 'CANCELADA') DEFAULT 'ABIERTA',\r\n        tiempo_solucion_horas DECIMAL(8,2),\r\n        observaciones TEXT,\r\n        ubicacion_falla VARCHAR(200) NOT NULL,\r\n        impacto ENUM('BAJO', 'MEDIO', 'ALTO', 'CRITICO') DEFAULT 'MEDIO',\r\n        requiere_repuestos BOOLEAN DEFAULT FALSE,\r\n        repuestos_utilizados TEXT,\r\n        costo_reparacion DECIMAL(10,2),\r\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\r\n        INDEX idx_no_serie (no_serie),\r\n        INDEX idx_estatus (estatus),\r\n        INDEX idx_fecha_reporte (fecha_reporte),\r\n        INDEX idx_tecnico (tecnico_asignado),\r\n        FOREIGN KEY (no_serie) REFERENCES equipo(no_serie) ON UPDATE CASCADE\r\n      )\r\n    `;\r\n\r\n    await executeQuery(createTableQuery);\r\n\r\n    // Insertar nueva falla\r\n    const insertQuery = `\r\n      INSERT INTO fallas_equipos (\r\n        no_serie, tipo_falla, descripcion_problema, sintomas, prioridad,\r\n        usuario_reporta, tecnico_asignado, ubicacion_falla, impacto,\r\n        requiere_repuestos, observaciones\r\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `;\r\n\r\n    const result = await executeQuery(insertQuery, [\r\n      no_serie,\r\n      tipo_falla,\r\n      descripcion_problema,\r\n      sintomas || '',\r\n      prioridad,\r\n      usuario_reporta,\r\n      tecnico_asignado || null,\r\n      ubicacion_falla,\r\n      impacto,\r\n      requiere_repuestos ? 1 : 0,\r\n      observaciones\r\n    ]);\r\n\r\n    // Actualizar estado del equipo si es necesario\r\n    if (prioridad === 'CRITICA' || impacto === 'CRITICO') {\r\n      await executeQuery(\r\n        `UPDATE equipo SET EstatusEquipo = 'Fuera de Servicio' WHERE no_serie = ?`,\r\n        [no_serie]\r\n      );\r\n    } else {\r\n      await executeQuery(\r\n        `UPDATE equipo SET EstatusEquipo = 'Con Falla' WHERE no_serie = ?`,\r\n        [no_serie]\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Falla registrada exitosamente',\r\n      data: {\r\n        fallaId: (result as any).insertId,\r\n        no_serie,\r\n        tipo_falla,\r\n        estatus: 'ABIERTA'\r\n      }\r\n    } as ApiResponse<any>);\r\n\r\n  } catch (error) {\r\n    console.error('Error creando falla:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      error: 'Error interno del servidor'\r\n    } as ApiResponse<any>, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT - Actualizar falla existente\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const {\r\n      id,\r\n      estatus,\r\n      tecnico_asignado,\r\n      solucion_aplicada,\r\n      tiempo_solucion_horas,\r\n      repuestos_utilizados,\r\n      costo_reparacion,\r\n      observaciones\r\n    } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'ID de falla requerido'\r\n      } as ApiResponse<any>, { status: 400 });\r\n    }\r\n\r\n    let updateQuery = `UPDATE fallas_equipos SET updated_at = CURRENT_TIMESTAMP`;\r\n    const params: any[] = [];\r\n\r\n    if (estatus) {\r\n      updateQuery += `, estatus = ?`;\r\n      params.push(estatus);\r\n      \r\n      if (estatus === 'RESUELTA') {\r\n        updateQuery += `, fecha_solucion = CURRENT_TIMESTAMP`;\r\n      }\r\n    }\r\n\r\n    if (tecnico_asignado !== undefined) {\r\n      updateQuery += `, tecnico_asignado = ?`;\r\n      params.push(tecnico_asignado);\r\n      \r\n      if (tecnico_asignado && estatus !== 'RESUELTA') {\r\n        updateQuery += `, estatus = 'EN_PROCESO'`;\r\n      }\r\n    }\r\n\r\n    if (solucion_aplicada !== undefined) {\r\n      updateQuery += `, solucion_aplicada = ?`;\r\n      params.push(solucion_aplicada);\r\n    }\r\n\r\n    if (tiempo_solucion_horas !== undefined) {\r\n      updateQuery += `, tiempo_solucion_horas = ?`;\r\n      params.push(tiempo_solucion_horas);\r\n    }\r\n\r\n    if (repuestos_utilizados !== undefined) {\r\n      updateQuery += `, repuestos_utilizados = ?`;\r\n      params.push(repuestos_utilizados);\r\n    }\r\n\r\n    if (costo_reparacion !== undefined) {\r\n      updateQuery += `, costo_reparacion = ?`;\r\n      params.push(costo_reparacion);\r\n    }\r\n\r\n    if (observaciones !== undefined) {\r\n      updateQuery += `, observaciones = ?`;\r\n      params.push(observaciones);\r\n    }\r\n\r\n    updateQuery += ` WHERE id = ?`;\r\n    params.push(id);\r\n\r\n    await executeQuery(updateQuery, params);\r\n\r\n    // Si la falla se resolvió, actualizar estado del equipo\r\n    if (estatus === 'RESUELTA') {\r\n      // Buscar el número de serie de la falla\r\n      const fallaQuery = `SELECT no_serie FROM fallas_equipos WHERE id = ?`;\r\n      const fallaResult = await executeQuery(fallaQuery, [id]);\r\n      \r\n      if (fallaResult.length > 0) {\r\n        const no_serie = (fallaResult[0] as any).no_serie;\r\n        \r\n        // Verificar si hay otras fallas abiertas para este equipo\r\n        const otrasFallasQuery = `\r\n          SELECT COUNT(*) as count \r\n          FROM fallas_equipos \r\n          WHERE no_serie = ? AND estatus IN ('ABIERTA', 'EN_PROCESO') AND id != ?\r\n        `;\r\n        const otrasFallas = await executeQuery(otrasFallasQuery, [no_serie, id]);\r\n        \r\n        // Si no hay otras fallas, poner el equipo como activo\r\n        if ((otrasFallas[0] as any).count === 0) {\r\n          await executeQuery(\r\n            `UPDATE equipo SET EstatusEquipo = 'Activo' WHERE no_serie = ?`,\r\n            [no_serie]\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Falla actualizada exitosamente'\r\n    } as ApiResponse<any>);\r\n\r\n  } catch (error) {\r\n    console.error('Error actualizando falla:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      error: 'Error interno del servidor'\r\n    } as ApiResponse<any>, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}