module.exports=[18622,(e,o,t)=>{o.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,o,t)=>{o.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,o,t)=>{o.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,o,t)=>{o.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},24361,(e,o,t)=>{o.exports=e.x("util",()=>require("util"))},12851,(e,o,t)=>{},55261,e=>{"use strict";e.s(["handler",()=>O,"patchFetch",()=>S,"routeModule",()=>C,"serverHooks",()=>N,"workAsyncStorage",()=>w,"workUnitAsyncStorage",()=>y],55261);var o=e.i(47909),t=e.i(74017),r=e.i(96250),s=e.i(59756),a=e.i(61916),i=e.i(69741),n=e.i(16795),u=e.i(87718),l=e.i(95169),p=e.i(47587),c=e.i(66012),d=e.i(70101),E=e.i(26937),R=e.i(10372),m=e.i(93695);e.i(52474);var g=e.i(220);e.s(["GET",()=>q,"POST",()=>v,"PUT",()=>f],13992);var x=e.i(89171),h=e.i(84168);async function q(e){try{console.log("API Equipos GET llamada");let{searchParams:o}=new URL(e.url),t={sucursal:o.get("sucursal")||void 0,tipoEquipo:o.get("tipoEquipo")||void 0,estatus:o.get("estatus")||void 0,usuario:o.get("usuario")||void 0,busqueda:o.get("busqueda")||void 0};Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),console.log("Filtros aplicados:",t);let r=await (0,h.getEquiposCompletos)(t);return x.NextResponse.json({success:!0,data:r,message:"Equipos obtenidos exitosamente"},{status:200})}catch(e){return console.error("Error obteniendo equipos:",e),x.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}async function v(e){try{let o=await e.json(),t=o.noSerie||o.no_serie,r=o.idUsuarios||o.usuarioAsignado;for(let{campo:e,valor:r}of(console.log("ðŸ“¦ Datos recibidos para crear equipo:",o),[{campo:"noSerie",valor:t},{campo:"nombreEquipo",valor:o.nombreEquipo},{campo:"modelo",valor:o.modelo},{campo:"idTipoEquipo",valor:o.idTipoEquipo},{campo:"idEstatus",valor:o.idEstatus},{campo:"idSucursal",valor:o.idSucursal}]))if(!r)return console.log(`âŒ Campo faltante: ${e}`,r),x.NextResponse.json({success:!1,error:`El campo ${e} es requerido`,message:"Datos incompletos"},{status:400});let s=async e=>{let o=await (0,h.executeQuery)(`
        SELECT TipoEquipo 
        FROM (
          SELECT ROW_NUMBER() OVER (ORDER BY TipoEquipo) as rownum, TipoEquipo
          FROM (SELECT DISTINCT TipoEquipo FROM GostCAM.VistaEquiposCompletos WHERE TipoEquipo IS NOT NULL) tipos
        ) t 
        WHERE rownum = ?
      `,[e]);return o.length>0?o[0].TipoEquipo:""},a=async e=>{if(console.log(`ðŸ” Mapeando sucursal ID/C\xf3digo: ${e} (tipo: ${typeof e})`),!e)return console.log("âŒ ID de sucursal vacÃ­o, usando fallback"),1;try{let o;if("string"==typeof e)o=e,console.log(`ðŸ“ Usando c\xf3digo de centro directamente: ${o}`);else{let t=await (0,h.executeQuery)(`
            SELECT idCentro, Sucursal
            FROM (
              SELECT ROW_NUMBER() OVER (ORDER BY Sucursal) as rownum, idCentro, Sucursal
              FROM sucursales
            ) s 
            WHERE rownum = ?
          `,[e]);if(0===t.length)return console.log(`âŒ No se encontr\xf3 sucursal con ID ${e}`),1;o=t[0].idCentro,console.log(`ðŸ“ ID ${e} mapeado a centro: ${o}`)}let t=await (0,h.executeQuery)(`
          SELECT p.idPosicion, p.NombrePosicion, s.Sucursal
          FROM posicionequipo p 
          JOIN sucursales s ON p.idCentro = s.idCentro
          WHERE p.idCentro = ?
          ORDER BY p.idPosicion
          LIMIT 1
        `,[o]);if(t.length>0){let e=t[0].idPosicion;return console.log(`âœ… Posici\xf3n asignada: ${e} (${t[0].NombrePosicion}) en ${t[0].Sucursal}`),e}return console.log("âŒ No se encontrÃ³ posiciÃ³n para el centro"),1}catch(e){return console.error("âŒ Error en mapearSucursal:",e),1}},i=async e=>{if(!e)return 1;if("number"==typeof e)return console.log(`âœ… Usuario ID recibido: ${e}`),e;try{let o=(await (0,h.executeQuery)(`
          SELECT ROW_NUMBER() OVER (ORDER BY UsuarioAsignado) as rownum, UsuarioAsignado
          FROM (
            SELECT DISTINCT UsuarioAsignado 
            FROM GostCAM.VistaEquiposCompletos 
            WHERE UsuarioAsignado IS NOT NULL AND UsuarioAsignado != ''
          ) usuarios
          ORDER BY UsuarioAsignado
        `)).find(o=>o.UsuarioAsignado.toLowerCase()===e.toLowerCase());if(o)return console.log(`âœ… Usuario "${e}" mapeado a ID: ${o.rownum}`),o.rownum;return console.log(`âš ï¸ Usuario "${e}" no encontrado, usando ID por defecto`),1}catch(e){return console.error("âŒ Error en mapearUsuario:",e),1}},n=async e=>{let o=await (0,h.executeQuery)(`
        SELECT EstatusEquipo 
        FROM (
          SELECT ROW_NUMBER() OVER (ORDER BY EstatusEquipo) as rownum, EstatusEquipo
          FROM (SELECT DISTINCT EstatusEquipo FROM GostCAM.VistaEquiposCompletos WHERE EstatusEquipo IS NOT NULL) estatus
        ) e 
        WHERE rownum = ?
      `,[e]);return o.length>0?o[0].EstatusEquipo:""};console.log("ðŸ“¥ Datos recibidos - idSucursal:",o.idSucursal,"tipo:",typeof o.idSucursal);let u=await s(parseInt(o.idTipoEquipo)),l=await a(o.idSucursal),p=await i(r),c=await n(parseInt(o.idEstatus));if(console.log("ðŸ“Š Mapeos realizados:"),console.log("- Tipo Equipo:",o.idTipoEquipo,"->",u),console.log("- idPosicion calculada:",l),console.log("- Usuario:",r,"->",p),console.log("- Estatus:",o.idEstatus,"->",c),console.log("ðŸ“¦ Datos a insertar:"),console.log("- No. Serie:",t),console.log("- Nombre Equipo:",o.nombreEquipo),console.log("- Modelo:",o.modelo),console.log("- Tipo Equipo ID:",o.idTipoEquipo,"(",u,")"),console.log("- Estatus ID:",o.idEstatus,"(",c,")"),console.log("- Usuario ID:",p),console.log("- PosiciÃ³n ID:",l),(await (0,h.executeQuery)("SELECT no_serie FROM Equipo WHERE no_serie = ?",[t])).length>0)return x.NextResponse.json({success:!1,error:"El nÃºmero de serie ya existe",message:"No se puede crear el equipo"},{status:409});let d=`
      INSERT INTO Equipo (
        no_serie, nombreEquipo, modelo, numeroActivo, 
        idTipoEquipo, idEstatus, idUsuarios, idPosicion
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `,E=[t,o.nombreEquipo,o.modelo,o.numeroActivo||t,o.idTipoEquipo,o.idEstatus,p,l];return await (0,h.executeQuery)(d,E),console.log("âœ… Equipo creado exitosamente"),x.NextResponse.json({success:!0,data:{no_serie:t,mensaje:"Equipo insertado correctamente"},message:"Equipo creado exitosamente"},{status:201})}catch(e){return console.error("ðŸ’¥ Error creando equipo:",e),x.NextResponse.json({success:!1,error:"Error interno del servidor",details:e instanceof Error?e.message:"Error desconocido",message:"No se pudo crear el equipo"},{status:500})}}async function f(e){try{let o=await e.json(),{no_serie:t}=o;if(!t)return x.NextResponse.json({success:!1,error:"NÃºmero de serie es requerido"},{status:400});let r=await (0,h.executeQuery)("SELECT no_serie FROM Equipo WHERE no_serie = ?",[t]);if(0===r.length)return x.NextResponse.json({success:!1,error:"Equipo no encontrado"},{status:404});let s=[],a=[];if(o.nombreEquipo&&(s.push("nombreEquipo = ?"),a.push(o.nombreEquipo)),o.modelo&&(s.push("modelo = ?"),a.push(o.modelo)),o.idTipoEquipo&&(s.push("idTipoEquipo = ?"),a.push(parseInt(o.idTipoEquipo))),o.idEstatus&&(s.push("idEstatus = ?"),a.push(parseInt(o.idEstatus))),o.idSucursal&&(s.push("idSucursal = ?"),a.push(parseInt(o.idSucursal))),o.idUsuarios&&(s.push("idUsuarios = ?"),a.push(parseInt(o.idUsuarios))),0===s.length)return x.NextResponse.json({success:!1,error:"No hay campos para actualizar"},{status:400});return a.push(t),await (0,h.executeQuery)(`
      UPDATE Equipos 
      SET ${s.join(", ")}
      WHERE no_serie = ?
    `,a),x.NextResponse.json({success:!0,message:"Equipo actualizado exitosamente"},{status:200})}catch(e){return console.error("Error actualizando equipo:",e),x.NextResponse.json({success:!1,error:"Error interno del servidor"},{status:500})}}var T=e.i(13992);let C=new o.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/equipos/route",pathname:"/api/equipos",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/equipos/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:w,workUnitAsyncStorage:y,serverHooks:N}=C;function S(){return(0,r.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:y})}async function O(e,o,r){var x;let h="/api/equipos/route";h=h.replace(/\/index$/,"")||"/";let q=await C.prepare(e,o,{srcPage:h,multiZoneDraftMode:!1});if(!q)return o.statusCode=400,o.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:f,nextConfig:T,isDraftMode:w,prerenderManifest:y,routerServerContext:N,isOnDemandRevalidate:S,revalidateOnlyGenerated:O,resolvedPathname:b}=q,A=(0,i.normalizeAppPath)(h),I=!!(y.dynamicRoutes[A]||y.routes[b]);if(I&&!w){let e=!!y.routes[b],o=y.dynamicRoutes[A];if(o&&!1===o.fallback&&!e)throw new m.NoFallbackError}let U=null;!I||C.isDev||w||(U="/index"===(U=b)?"/":U);let D=!0===C.isDev||!I,M=I&&!D,j=e.method||"GET",P=(0,a.getTracer)(),_=P.getActiveScopeSpan(),L={params:f,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!T.experimental.cacheComponents,authInterrupts:!!T.experimental.authInterrupts},supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(x=T.experimental)?void 0:x.cacheLife,isRevalidate:M,waitUntil:r.waitUntil,onClose:e=>{o.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(o,t,r)=>C.onRequestError(e,o,r,N)},sharedContext:{buildId:v}},H=new n.NodeNextRequest(e),$=new n.NodeNextResponse(o),k=u.NextRequestAdapter.fromNodeNextRequest(H,(0,u.signalFromNodeResponse)(o));try{let i=async t=>C.handle(k,L).finally(()=>{if(!t)return;t.setAttributes({"http.status_code":o.statusCode,"next.rsc":!1});let r=P.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let e=`${j} ${s}`;t.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),t.updateName(e)}else t.updateName(`${j} ${e.url}`)}),n=async a=>{var n,u;let l=async({previousCacheEntry:t})=>{try{if(!(0,s.getRequestMeta)(e,"minimalMode")&&S&&O&&!t)return o.statusCode=404,o.setHeader("x-nextjs-cache","REVALIDATED"),o.end("This page could not be found"),null;let n=await i(a);e.fetchMetrics=L.renderOpts.fetchMetrics;let u=L.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let l=L.renderOpts.collectedTags;if(!I)return await (0,c.sendResponse)(H,$,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),o=(0,d.toNodeOutgoingHttpHeaders)(n.headers);l&&(o[R.NEXT_CACHE_TAGS_HEADER]=l),!o["content-type"]&&e.type&&(o["content-type"]=e.type);let t=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,r=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:o},cacheControl:{revalidate:t,expire:r}}}}catch(o){throw(null==t?void 0:t.isStale)&&await C.onRequestError(e,o,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isRevalidate:M,isOnDemandRevalidate:S})},N),o}},m=await C.handleResponse({req:e,nextConfig:T,cacheKey:U,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:O,responseGenerator:l,waitUntil:r.waitUntil});if(!I)return null;if((null==m||null==(n=m.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==m||null==(u=m.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,s.getRequestMeta)(e,"minimalMode")||o.setHeader("x-nextjs-cache",S?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),w&&o.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,d.fromNodeOutgoingHttpHeaders)(m.value.headers);return(0,s.getRequestMeta)(e,"minimalMode")&&I||x.delete(R.NEXT_CACHE_TAGS_HEADER),!m.cacheControl||o.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,E.getCacheControlHeader)(m.cacheControl)),await (0,c.sendResponse)(H,$,new Response(m.value.body,{headers:x,status:m.value.status||200})),null};_?await n(_):await P.withPropagatedContext(e.headers,()=>P.trace(l.BaseServerSpan.handleRequest,{spanName:`${j} ${e.url}`,kind:a.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},n))}catch(o){if(o instanceof m.NoFallbackError||await C.onRequestError(e,o,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isRevalidate:M,isOnDemandRevalidate:S})}),I)throw o;return await (0,c.sendResponse)(H,$,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__0e278f07._.js.map