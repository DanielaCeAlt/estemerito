{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danie/OneDrive/Documentos/GostCAM%20-%202111%20-%20copia/GostCAM%20-%20Frontend/src/lib/database.ts"],"sourcesContent":["// =============================================\r\n// CONFIGURACIÓN DE BASE DE DATOS MYSQL\r\n// =============================================\r\n\r\nimport mysql from 'mysql2/promise';\r\nimport { VistaEquipoCompleto, VistaMovimientoDetallado } from '@/types/database';\r\n\r\n// Configuración de la conexión a la base de datos\r\nconst dbConfig = {\r\n  host: process.env.DB_HOST || 'localhost',\r\n  port: parseInt(process.env.DB_PORT || '3306'),\r\n  user: process.env.DB_USER || 'root',\r\n  password: process.env.DB_PASSWORD || '',\r\n  database: process.env.DB_NAME || 'GostCAM',\r\n  charset: 'utf8mb4',\r\n  timezone: '+00:00',\r\n};\r\n\r\n// Pool de conexiones para mejor performance\r\nconst pool = mysql.createPool({\r\n  ...dbConfig,\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  queueLimit: 0,\r\n});\r\n\r\n// Función para obtener una conexión del pool\r\nexport const getConnection = async () => {\r\n  try {\r\n    const connection = await pool.getConnection();\r\n    return connection;\r\n  } catch (error) {\r\n    console.error('Error connecting to the database:', error);\r\n    throw new Error('Failed to connect to database');\r\n  }\r\n};\r\n\r\n// Función para ejecutar queries con manejo de errores\r\nexport const executeQuery = async <T = Record<string, unknown>>(\r\n  query: string,\r\n  params: (string | number | Date | null | undefined)[] = []\r\n): Promise<T[]> => {\r\n  let connection;\r\n  try {\r\n    connection = await getConnection();\r\n    const [rows] = await connection.execute(query, params);\r\n    return rows as T[];\r\n  } catch (error) {\r\n    console.error('Database query error:', error);\r\n    console.error('Query:', query);\r\n    console.error('Params:', params);\r\n    throw error;\r\n  } finally {\r\n    if (connection) {\r\n      connection.release();\r\n    }\r\n  }\r\n};\r\n\r\n// Función para ejecutar procedimientos almacenados\r\nexport const callStoredProcedure = async <T = Record<string, unknown>>(\r\n  procedureName: string,\r\n  params: (string | number | Date | null | undefined)[] = []\r\n): Promise<T[]> => {\r\n  const placeholders = params.map(() => '?').join(', ');\r\n  const query = `CALL ${procedureName}(${placeholders})`;\r\n  \r\n  let connection;\r\n  try {\r\n    connection = await getConnection();\r\n    const [rows] = await connection.execute(query, params);\r\n    // Los procedimientos almacenados devuelven arrays anidados\r\n    return Array.isArray(rows) && Array.isArray(rows[0]) ? rows[0] as T[] : rows as T[];\r\n  } catch (error) {\r\n    console.error('Stored procedure error:', error);\r\n    console.error('Procedure:', procedureName);\r\n    console.error('Params:', params);\r\n    throw error;\r\n  } finally {\r\n    if (connection) {\r\n      connection.release();\r\n    }\r\n  }\r\n};\r\n\r\n// Función para verificar la conexión a la base de datos\r\nexport const testConnection = async (): Promise<boolean> => {\r\n  try {\r\n    const result = await executeQuery('SELECT 1 as test');\r\n    return result.length > 0;\r\n  } catch (error) {\r\n    console.error('Database connection test failed:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Función para cerrar el pool de conexiones\r\nexport const closePool = async (): Promise<void> => {\r\n  try {\r\n    await pool.end();\r\n    console.log('Database pool closed');\r\n  } catch (error) {\r\n    console.error('Error closing database pool:', error);\r\n  }\r\n};\r\n\r\n// Funciones específicas para las vistas de GostCAM\r\nexport const getEquiposCompletos = async (filters?: {\r\n  sucursal?: string;\r\n  tipoEquipo?: string;\r\n  estatus?: string;\r\n  usuario?: string;\r\n  busqueda?: string;\r\n}): Promise<VistaEquipoCompleto[]> => {\r\n  // Usar directamente la tabla equipo con una consulta simple\r\n  return await getEquiposFromTable(filters);\r\n};\r\n\r\n// Función fallback para consultar tabla equipos directamente\r\nconst getEquiposFromTable = async (filters?: {\r\n  sucursal?: string;\r\n  tipoEquipo?: string;\r\n  estatus?: string;\r\n  usuario?: string;\r\n  busqueda?: string;\r\n}): Promise<VistaEquipoCompleto[]> => {\r\n  let query = `\r\n    SELECT \r\n      e.no_serie,\r\n      e.nombreEquipo,\r\n      e.numeroActivo,\r\n      e.modelo,\r\n      e.fechaAlta,\r\n      e.idPosicion,\r\n      te.nombreTipo as TipoEquipo,\r\n      ee.estatus as EstatusEquipo,\r\n      COALESCE(s.Sucursal, 'Centro Principal') as SucursalActual,\r\n      u.NombreUsuario as UsuarioAsignado\r\n    FROM equipo e\r\n    LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo\r\n    LEFT JOIN estatusequipo ee ON e.idEstatus = ee.idEstatus\r\n    LEFT JOIN usuarios u ON e.idUsuarios = u.idUsuarios\r\n    LEFT JOIN posicionequipo pe ON e.idPosicion = pe.idPosicion\r\n    LEFT JOIN sucursales s ON pe.idCentro = s.idCentro\r\n  `;\r\n  \r\n  const params: (string | number | Date | null | undefined)[] = [];\r\n  const conditions: string[] = [];\r\n\r\n  // ✅ Filtrar equipos eliminados lógicamente\r\n  conditions.push('(e.eliminado IS NULL OR e.eliminado = 0)');\r\n\r\n  if (filters) {\r\n    if (filters.tipoEquipo) {\r\n      conditions.push('te.nombreTipo = ?');\r\n      params.push(filters.tipoEquipo);\r\n    }\r\n    if (filters.estatus) {\r\n      conditions.push('ee.estatus = ?');\r\n      params.push(filters.estatus);\r\n    }\r\n    if (filters.sucursal) {\r\n      conditions.push('s.Sucursal = ?');\r\n      params.push(filters.sucursal);\r\n    }\r\n    if (filters.usuario) {\r\n      conditions.push('u.NombreUsuario LIKE ?');\r\n      params.push(`%${filters.usuario}%`);\r\n    }\r\n    if (filters.busqueda) {\r\n      // Búsqueda global en todos los campos principales (función fallback)\r\n      conditions.push(`(\r\n        e.nombreEquipo LIKE ? OR \r\n        e.no_serie LIKE ? OR \r\n        e.numeroActivo LIKE ? OR\r\n        e.modelo LIKE ? OR\r\n        te.nombreTipo LIKE ? OR\r\n        ee.estatus LIKE ? OR\r\n        s.Sucursal LIKE ? OR\r\n        u.NombreUsuario LIKE ?\r\n      )`);\r\n      // Repetir el término de búsqueda para cada campo\r\n      const termino = `%${filters.busqueda}%`;\r\n      params.push(termino, termino, termino, termino, termino, termino, termino, termino);\r\n    }\r\n  }\r\n\r\n  if (conditions.length > 0) {\r\n    query += ' WHERE ' + conditions.join(' AND ');\r\n  }\r\n\r\n  query += ' ORDER BY e.fechaAlta DESC';\r\n\r\n  const result = await executeQuery<VistaEquipoCompleto>(query, params);\r\n  \r\n  return result;\r\n};\r\n\r\nexport const getMovimientosDetallados = async (filters?: {\r\n  sucursalOrigen?: string;\r\n  sucursalDestino?: string;\r\n  tipoMovimiento?: string;\r\n  estatusMovimiento?: string;\r\n  fechaDesde?: string;\r\n  fechaHasta?: string;\r\n}): Promise<VistaMovimientoDetallado[]> => {\r\n  let query = 'SELECT * FROM VistaMovimientosDetallados';\r\n  const params: (string | number | Date | null | undefined)[] = [];\r\n  const conditions: string[] = [];\r\n\r\n  if (filters) {\r\n    if (filters.sucursalOrigen) {\r\n      conditions.push('SucursalOrigen = ?');\r\n      params.push(filters.sucursalOrigen);\r\n    }\r\n    if (filters.sucursalDestino) {\r\n      conditions.push('SucursalDestino = ?');\r\n      params.push(filters.sucursalDestino);\r\n    }\r\n    if (filters.tipoMovimiento) {\r\n      conditions.push('tipoMovimiento = ?');\r\n      params.push(filters.tipoMovimiento);\r\n    }\r\n    if (filters.estatusMovimiento) {\r\n      conditions.push('estatusMovimiento = ?');\r\n      params.push(filters.estatusMovimiento);\r\n    }\r\n    if (filters.fechaDesde) {\r\n      conditions.push('fecha >= ?');\r\n      params.push(filters.fechaDesde);\r\n    }\r\n    if (filters.fechaHasta) {\r\n      conditions.push('fecha <= ?');\r\n      params.push(filters.fechaHasta);\r\n    }\r\n  }\r\n\r\n  if (conditions.length > 0) {\r\n    query += ' WHERE ' + conditions.join(' AND ');\r\n  }\r\n\r\n  query += ' ORDER BY fecha DESC';\r\n\r\n  return executeQuery<VistaMovimientoDetallado>(query, params);\r\n};\r\n\r\nexport const getInventarioPorEstatus = async () => {\r\n  return executeQuery('SELECT * FROM VistaInventarioPorEstatus ORDER BY estatus, TipoEquipo');\r\n};\r\n\r\n// Función para obtener todos los catálogos del sistema\r\nexport const getCatalogos = async () => {\r\n  try {\r\n    console.log('Obteniendo catálogos...');\r\n    \r\n    // Función auxiliar para ejecutar consultas con fallback\r\n    const executeWithFallback = async (query: string, fallback: any[] = []) => {\r\n      try {\r\n        return await executeQuery(query);\r\n      } catch (error) {\r\n        console.warn(`Query failed: ${query}`, error);\r\n        return fallback;\r\n      }\r\n    };\r\n\r\n    // Obtener catálogos básicos que probablemente existan\r\n    const usuarios = await executeWithFallback('SELECT * FROM usuarios', []);\r\n    \r\n    // Para tipos de equipo, intentar múltiples variantes\r\n    const tiposEquipo = await executeWithFallback('SELECT * FROM tipoequipo', []);\r\n    \r\n    // Para estatus, intentar múltiples variantes  \r\n    const estatusEquipos = await executeWithFallback('SELECT * FROM estatusequipo', []);\r\n    \r\n    // Para posiciones, usar valores por defecto si no existe\r\n    const posiciones = await executeWithFallback('SELECT * FROM posiciones', [\r\n      { id: 1, nombre: 'Entrada Principal' },\r\n      { id: 2, nombre: 'Recepción' },\r\n      { id: 3, nombre: 'Oficina' }\r\n    ]);\r\n\r\n    // Para sucursales, intentar obtener de la tabla de equipos o crear por defecto\r\n    const sucursales = await executeWithFallback('SELECT DISTINCT SucursalActual as nombre, SucursalActual as id FROM equipos WHERE SucursalActual IS NOT NULL AND SucursalActual != \"\"', [\r\n      { id: 'SUC001', nombre: 'Sucursal Principal' },\r\n      { id: 'SUC002', nombre: 'Sucursal Norte' },\r\n      { id: 'SUC003', nombre: 'Sucursal Sur' }\r\n    ]);\r\n\r\n    return {\r\n      tiposEquipo,\r\n      estatusEquipos,\r\n      usuarios,\r\n      posiciones,\r\n      sucursales,\r\n      // Catálogos adicionales vacíos por ahora\r\n      estados: [],\r\n      municipios: [],\r\n      zonas: []\r\n    };\r\n  } catch (error) {\r\n    console.error('Error obteniendo catálogos:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const getHistorialMovimientos = async (no_serie?: string) => {\r\n  if (no_serie) {\r\n    return executeQuery('SELECT * FROM VistaHistorialMovimientos WHERE no_serie = ? ORDER BY fecha DESC', [no_serie]);\r\n  }\r\n  return executeQuery('SELECT * FROM VistaHistorialMovimientos ORDER BY fecha DESC LIMIT 100');\r\n};\r\n\r\nexport default pool;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danie/OneDrive/Documentos/GostCAM%20-%202111%20-%20copia/GostCAM%20-%20Frontend/src/app/api/dashboard/route.ts"],"sourcesContent":["// =============================================\n// API: DASHBOARD ESTADÍSTICAS\n// =============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { executeQuery } from '@/lib/database';\nimport { DashboardStats, ApiResponse } from '@/types/database';\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Obtener estadísticas básicas\n    const statsQuery = `\n      SELECT \n        COUNT(*) as totalEquipos,\n        SUM(CASE WHEN idEstatus = 1 THEN 1 ELSE 0 END) as equiposDisponibles,\n        SUM(CASE WHEN idEstatus = 2 THEN 1 ELSE 0 END) as equiposEnUso,\n        SUM(CASE WHEN idEstatus IN (3, 7) THEN 1 ELSE 0 END) as equiposMantenimiento,\n        SUM(CASE WHEN idEstatus = 6 THEN 1 ELSE 0 END) as equiposDañados\n      FROM equipo\n    `;\n\n    const [stats] = await executeQuery(statsQuery);\n\n    // Obtener movimientos abiertos\n    const movimientosAbiertosQuery = `\n      SELECT COUNT(*) as movimientosAbiertos\n      FROM movimientoinventario \n      WHERE estatusMovimiento = 'ABIERTO'\n    `;\n\n    const [movimientosAbiertos] = await executeQuery(movimientosAbiertosQuery);\n\n    // Obtener movimientos del mes actual\n    const movimientosMesQuery = `\n      SELECT COUNT(*) as movimientosMes\n      FROM movimientoinventario \n      WHERE MONTH(fecha) = MONTH(CURRENT_DATE()) \n      AND YEAR(fecha) = YEAR(CURRENT_DATE())\n    `;\n\n    const [movimientosMes] = await executeQuery(movimientosMesQuery);\n\n    // Obtener equipos por tipo\n    const equiposPorTipoQuery = `\n      SELECT \n        te.nombreTipo as tipo,\n        COUNT(e.no_serie) as cantidad\n      FROM tipoequipo te\n      LEFT JOIN equipo e ON te.idTipoEquipo = e.idTipoEquipo\n      GROUP BY te.idTipoEquipo, te.nombreTipo\n      HAVING cantidad > 0\n      ORDER BY cantidad DESC\n      LIMIT 10\n    `;\n\n    const equiposPorTipo = await executeQuery(equiposPorTipoQuery);\n\n    // Obtener movimientos por mes (últimos 6 meses)\n    const movimientosPorMesQuery = `\n      SELECT \n        DATE_FORMAT(fecha, '%Y-%m') as mes,\n        COUNT(*) as cantidad\n      FROM movimientoinventario \n      WHERE fecha >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 MONTH)\n      GROUP BY DATE_FORMAT(fecha, '%Y-%m')\n      ORDER BY mes DESC\n    `;\n\n    const movimientosPorMes = await executeQuery(movimientosPorMesQuery);\n\n    // Obtener porcentajes por estatus\n    const estatusPorcentajesQuery = `\n      SELECT \n        es.estatus,\n        COUNT(e.no_serie) as cantidad,\n        ROUND((COUNT(e.no_serie) * 100.0 / (SELECT COUNT(*) FROM equipo)), 2) as porcentaje\n      FROM estatusequipo es\n      LEFT JOIN equipo e ON es.idEstatus = e.idEstatus\n      GROUP BY es.idEstatus, es.estatus\n      HAVING cantidad > 0\n      ORDER BY cantidad DESC\n    `;\n\n    const estatusData = await executeQuery(estatusPorcentajesQuery);\n\n    // Definir colores para cada estatus\n    const colores = {\n      'Disponible': '#10B981',\n      'En uso': '#3B82F6',\n      'Mantenimiento': '#F59E0B',\n      'En reparación': '#F59E0B',\n      'Baja': '#6B7280',\n      'Extraviado': '#EF4444',\n      'Dañado': '#DC2626',\n      'Obsoleto': '#6B7280'\n    };\n\n    type EstatusRow = { estatus: string; porcentaje: string | number };\n    const estatusPorcentajes = (estatusData as EstatusRow[]).map((item) => ({\n      estatus: item.estatus,\n      porcentaje: typeof item.porcentaje === 'string' ? parseFloat(item.porcentaje) : item.porcentaje,\n      color: colores[item.estatus as keyof typeof colores] || '#6B7280'\n    }));\n\n    // Formatear movimientos por mes\n    type MovMesRow = { mes: string; cantidad: number };\n    const movimientosFormateados = (movimientosPorMes as MovMesRow[]).map((item) => {\n      const [year, month] = item.mes.split('-');\n      const monthNames = [\n        'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',\n        'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'\n      ];\n      return {\n        mes: `${monthNames[parseInt(month) - 1]} ${year}`,\n        cantidad: item.cantidad\n      };\n    });\n\n    type StatsRow = { \n      totalEquipos?: number; \n      equiposDisponibles?: number; \n      equiposEnUso?: number; \n      equiposMantenimiento?: number; \n      equiposDañados?: number;\n    };\n    type MovAbiertosRow = { movimientosAbiertos?: number };\n    type MovMesStatsRow = { movimientosMes?: number };\n\n    const statsTyped = stats as StatsRow;\n    const movAbiertosTyped = movimientosAbiertos as MovAbiertosRow;\n    const movMesTyped = movimientosMes as MovMesStatsRow;\n\n    const dashboardData: DashboardStats = {\n      totalEquipos: statsTyped.totalEquipos || 0,\n      equiposDisponibles: statsTyped.equiposDisponibles || 0,\n      equiposEnUso: statsTyped.equiposEnUso || 0,\n      equiposMantenimiento: statsTyped.equiposMantenimiento || 0,\n      equiposDañados: statsTyped.equiposDañados || 0,\n      movimientosAbiertos: movAbiertosTyped.movimientosAbiertos || 0,\n      movimientosMes: movMesTyped.movimientosMes || 0,\n      equiposPorTipo: (equiposPorTipo as { tipo: string; cantidad: number; }[]) || [],\n      movimientosPorMes: movimientosFormateados || [],\n      estatusPorcentajes: estatusPorcentajes || []\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: dashboardData,\n      message: 'Dashboard cargado exitosamente'\n    } as ApiResponse<DashboardStats>, { status: 200 });\n\n  } catch (error) {\n    console.error('Error obteniendo datos del dashboard:', error);\n    return NextResponse.json({\n      success: false,\n      error: 'Error interno del servidor'\n    } as ApiResponse<DashboardStats>, { status: 500 });\n  }\n}"],"names":[],"mappings":"AAAA,gDAAgD;AAChD,8BAA8B;AAC9B,gDAAgD;;;;;AAEhD;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,+BAA+B;QAC/B,MAAM,aAAa,CAAC;;;;;;;;IAQpB,CAAC;QAED,MAAM,CAAC,MAAM,GAAG,MAAM,IAAA,wIAAY,EAAC;QAEnC,+BAA+B;QAC/B,MAAM,2BAA2B,CAAC;;;;IAIlC,CAAC;QAED,MAAM,CAAC,oBAAoB,GAAG,MAAM,IAAA,wIAAY,EAAC;QAEjD,qCAAqC;QACrC,MAAM,sBAAsB,CAAC;;;;;IAK7B,CAAC;QAED,MAAM,CAAC,eAAe,GAAG,MAAM,IAAA,wIAAY,EAAC;QAE5C,2BAA2B;QAC3B,MAAM,sBAAsB,CAAC;;;;;;;;;;IAU7B,CAAC;QAED,MAAM,iBAAiB,MAAM,IAAA,wIAAY,EAAC;QAE1C,gDAAgD;QAChD,MAAM,yBAAyB,CAAC;;;;;;;;IAQhC,CAAC;QAED,MAAM,oBAAoB,MAAM,IAAA,wIAAY,EAAC;QAE7C,kCAAkC;QAClC,MAAM,0BAA0B,CAAC;;;;;;;;;;IAUjC,CAAC;QAED,MAAM,cAAc,MAAM,IAAA,wIAAY,EAAC;QAEvC,oCAAoC;QACpC,MAAM,UAAU;YACd,cAAc;YACd,UAAU;YACV,iBAAiB;YACjB,iBAAiB;YACjB,QAAQ;YACR,cAAc;YACd,UAAU;YACV,YAAY;QACd;QAGA,MAAM,qBAAqB,AAAC,YAA6B,GAAG,CAAC,CAAC,OAAS,CAAC;gBACtE,SAAS,KAAK,OAAO;gBACrB,YAAY,OAAO,KAAK,UAAU,KAAK,WAAW,WAAW,KAAK,UAAU,IAAI,KAAK,UAAU;gBAC/F,OAAO,OAAO,CAAC,KAAK,OAAO,CAAyB,IAAI;YAC1D,CAAC;QAID,MAAM,yBAAyB,AAAC,kBAAkC,GAAG,CAAC,CAAC;YACrE,MAAM,CAAC,MAAM,MAAM,GAAG,KAAK,GAAG,CAAC,KAAK,CAAC;YACrC,MAAM,aAAa;gBACjB;gBAAO;gBAAO;gBAAO;gBAAO;gBAAO;gBACnC;gBAAO;gBAAO;gBAAO;gBAAO;gBAAO;aACpC;YACD,OAAO;gBACL,KAAK,GAAG,UAAU,CAAC,SAAS,SAAS,EAAE,CAAC,CAAC,EAAE,MAAM;gBACjD,UAAU,KAAK,QAAQ;YACzB;QACF;QAYA,MAAM,aAAa;QACnB,MAAM,mBAAmB;QACzB,MAAM,cAAc;QAEpB,MAAM,gBAAgC;YACpC,cAAc,WAAW,YAAY,IAAI;YACzC,oBAAoB,WAAW,kBAAkB,IAAI;YACrD,cAAc,WAAW,YAAY,IAAI;YACzC,sBAAsB,WAAW,oBAAoB,IAAI;YACzD,gBAAgB,WAAW,cAAc,IAAI;YAC7C,qBAAqB,iBAAiB,mBAAmB,IAAI;YAC7D,gBAAgB,YAAY,cAAc,IAAI;YAC9C,gBAAgB,AAAC,kBAA4D,EAAE;YAC/E,mBAAmB,0BAA0B,EAAE;YAC/C,oBAAoB,sBAAsB,EAAE;QAC9C;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,SAAS;QACX,GAAkC;YAAE,QAAQ;QAAI;IAElD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;QACT,GAAkC;YAAE,QAAQ;QAAI;IAClD;AACF","debugId":null}}]
}