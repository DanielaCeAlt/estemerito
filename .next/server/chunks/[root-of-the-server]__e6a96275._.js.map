{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danie/OneDrive/Documentos/GostCAM/GostCAM%20-%20Frontend/src/lib/database.ts"],"sourcesContent":["// =============================================\r\n// CONFIGURACIÓN DE BASE DE DATOS MYSQL\r\n// =============================================\r\n\r\nimport mysql from 'mysql2/promise';\r\nimport { VistaEquipoCompleto, VistaMovimientoDetallado } from '@/types/database';\r\n\r\n// Configuración de la conexión a la base de datos\r\nconst dbConfig = {\r\n  host: process.env.DB_HOST || 'localhost',\r\n  port: parseInt(process.env.DB_PORT || '3306'),\r\n  user: process.env.DB_USER || 'root',\r\n  password: process.env.DB_PASSWORD || '',\r\n  database: process.env.DB_NAME || 'GostCAM',\r\n  charset: 'utf8mb4',\r\n  timezone: '+00:00',\r\n};\r\n\r\n// Pool de conexiones para mejor performance\r\nconst pool = mysql.createPool({\r\n  ...dbConfig,\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  queueLimit: 0,\r\n});\r\n\r\n// Función para obtener una conexión del pool\r\nexport const getConnection = async () => {\r\n  try {\r\n    const connection = await pool.getConnection();\r\n    return connection;\r\n  } catch (error) {\r\n    console.error('Error connecting to the database:', error);\r\n    throw new Error('Failed to connect to database');\r\n  }\r\n};\r\n\r\n// Función para ejecutar queries con manejo de errores\r\nexport const executeQuery = async <T = Record<string, unknown>>(\r\n  query: string,\r\n  params: (string | number | Date | null | undefined)[] = []\r\n): Promise<T[]> => {\r\n  let connection;\r\n  try {\r\n    connection = await getConnection();\r\n    const [rows] = await connection.execute(query, params);\r\n    return rows as T[];\r\n  } catch (error) {\r\n    console.error('Database query error:', error);\r\n    console.error('Query:', query);\r\n    console.error('Params:', params);\r\n    throw error;\r\n  } finally {\r\n    if (connection) {\r\n      connection.release();\r\n    }\r\n  }\r\n};\r\n\r\n// Función para ejecutar procedimientos almacenados\r\nexport const callStoredProcedure = async <T = Record<string, unknown>>(\r\n  procedureName: string,\r\n  params: (string | number | Date | null | undefined)[] = []\r\n): Promise<T[]> => {\r\n  const placeholders = params.map(() => '?').join(', ');\r\n  const query = `CALL ${procedureName}(${placeholders})`;\r\n  \r\n  let connection;\r\n  try {\r\n    connection = await getConnection();\r\n    const [rows] = await connection.execute(query, params);\r\n    // Los procedimientos almacenados devuelven arrays anidados\r\n    return Array.isArray(rows) && Array.isArray(rows[0]) ? rows[0] as T[] : rows as T[];\r\n  } catch (error) {\r\n    console.error('Stored procedure error:', error);\r\n    console.error('Procedure:', procedureName);\r\n    console.error('Params:', params);\r\n    throw error;\r\n  } finally {\r\n    if (connection) {\r\n      connection.release();\r\n    }\r\n  }\r\n};\r\n\r\n// Función para verificar la conexión a la base de datos\r\nexport const testConnection = async (): Promise<boolean> => {\r\n  try {\r\n    const result = await executeQuery('SELECT 1 as test');\r\n    return result.length > 0;\r\n  } catch (error) {\r\n    console.error('Database connection test failed:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Función para cerrar el pool de conexiones\r\nexport const closePool = async (): Promise<void> => {\r\n  try {\r\n    await pool.end();\r\n    console.log('Database pool closed');\r\n  } catch (error) {\r\n    console.error('Error closing database pool:', error);\r\n  }\r\n};\r\n\r\n// Funciones específicas para las vistas de GostCAM\r\nexport const getEquiposCompletos = async (filters?: {\r\n  sucursal?: string;\r\n  tipoEquipo?: string;\r\n  estatus?: string;\r\n  usuario?: string;\r\n  busqueda?: string;\r\n}): Promise<VistaEquipoCompleto[]> => {\r\n  // Usar directamente la tabla equipo con una consulta simple\r\n  return await getEquiposFromTable(filters);\r\n};\r\n\r\n// Función fallback para consultar tabla equipos directamente\r\nconst getEquiposFromTable = async (filters?: {\r\n  sucursal?: string;\r\n  tipoEquipo?: string;\r\n  estatus?: string;\r\n  usuario?: string;\r\n  busqueda?: string;\r\n}): Promise<VistaEquipoCompleto[]> => {\r\n  let query = `\r\n    SELECT \r\n      e.no_serie,\r\n      e.nombreEquipo,\r\n      e.numeroActivo,\r\n      e.modelo,\r\n      e.fechaAlta,\r\n      e.idPosicion,\r\n      te.nombreTipo as TipoEquipo,\r\n      ee.estatus as EstatusEquipo,\r\n      COALESCE(s.Sucursal, 'Centro Principal') as SucursalActual,\r\n      u.NombreUsuario as UsuarioAsignado\r\n    FROM equipo e\r\n    LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo\r\n    LEFT JOIN estatusequipo ee ON e.idEstatus = ee.idEstatus\r\n    LEFT JOIN usuarios u ON e.idUsuarios = u.idUsuarios\r\n    LEFT JOIN posicionequipo pe ON e.idPosicion = pe.idPosicion\r\n    LEFT JOIN sucursales s ON pe.idCentro = s.idCentro\r\n  `;\r\n  \r\n  const params: (string | number | Date | null | undefined)[] = [];\r\n  const conditions: string[] = [];\r\n\r\n  // ✅ Filtrar equipos eliminados lógicamente\r\n  conditions.push('(e.eliminado IS NULL OR e.eliminado = 0)');\r\n\r\n  if (filters) {\r\n    if (filters.tipoEquipo) {\r\n      conditions.push('te.nombreTipo = ?');\r\n      params.push(filters.tipoEquipo);\r\n    }\r\n    if (filters.estatus) {\r\n      conditions.push('ee.estatus = ?');\r\n      params.push(filters.estatus);\r\n    }\r\n    if (filters.sucursal) {\r\n      conditions.push('s.Sucursal = ?');\r\n      params.push(filters.sucursal);\r\n    }\r\n    if (filters.usuario) {\r\n      conditions.push('u.NombreUsuario LIKE ?');\r\n      params.push(`%${filters.usuario}%`);\r\n    }\r\n    if (filters.busqueda) {\r\n      // Búsqueda global en todos los campos principales (función fallback)\r\n      conditions.push(`(\r\n        e.nombreEquipo LIKE ? OR \r\n        e.no_serie LIKE ? OR \r\n        e.numeroActivo LIKE ? OR\r\n        e.modelo LIKE ? OR\r\n        te.nombreTipo LIKE ? OR\r\n        ee.estatus LIKE ? OR\r\n        s.Sucursal LIKE ? OR\r\n        u.NombreUsuario LIKE ?\r\n      )`);\r\n      // Repetir el término de búsqueda para cada campo\r\n      const termino = `%${filters.busqueda}%`;\r\n      params.push(termino, termino, termino, termino, termino, termino, termino, termino);\r\n    }\r\n  }\r\n\r\n  if (conditions.length > 0) {\r\n    query += ' WHERE ' + conditions.join(' AND ');\r\n  }\r\n\r\n  query += ' ORDER BY e.fechaAlta DESC';\r\n\r\n  const result = await executeQuery<VistaEquipoCompleto>(query, params);\r\n  \r\n  return result;\r\n};\r\n\r\nexport const getMovimientosDetallados = async (filters?: {\r\n  sucursalOrigen?: string;\r\n  sucursalDestino?: string;\r\n  tipoMovimiento?: string;\r\n  estatusMovimiento?: string;\r\n  fechaDesde?: string;\r\n  fechaHasta?: string;\r\n}): Promise<VistaMovimientoDetallado[]> => {\r\n  let query = 'SELECT * FROM VistaMovimientosDetallados';\r\n  const params: (string | number | Date | null | undefined)[] = [];\r\n  const conditions: string[] = [];\r\n\r\n  if (filters) {\r\n    if (filters.sucursalOrigen) {\r\n      conditions.push('SucursalOrigen = ?');\r\n      params.push(filters.sucursalOrigen);\r\n    }\r\n    if (filters.sucursalDestino) {\r\n      conditions.push('SucursalDestino = ?');\r\n      params.push(filters.sucursalDestino);\r\n    }\r\n    if (filters.tipoMovimiento) {\r\n      conditions.push('tipoMovimiento = ?');\r\n      params.push(filters.tipoMovimiento);\r\n    }\r\n    if (filters.estatusMovimiento) {\r\n      conditions.push('estatusMovimiento = ?');\r\n      params.push(filters.estatusMovimiento);\r\n    }\r\n    if (filters.fechaDesde) {\r\n      conditions.push('fecha >= ?');\r\n      params.push(filters.fechaDesde);\r\n    }\r\n    if (filters.fechaHasta) {\r\n      conditions.push('fecha <= ?');\r\n      params.push(filters.fechaHasta);\r\n    }\r\n  }\r\n\r\n  if (conditions.length > 0) {\r\n    query += ' WHERE ' + conditions.join(' AND ');\r\n  }\r\n\r\n  query += ' ORDER BY fecha DESC';\r\n\r\n  return executeQuery<VistaMovimientoDetallado>(query, params);\r\n};\r\n\r\nexport const getInventarioPorEstatus = async () => {\r\n  return executeQuery('SELECT * FROM VistaInventarioPorEstatus ORDER BY estatus, TipoEquipo');\r\n};\r\n\r\n// Función para obtener todos los catálogos del sistema\r\nexport const getCatalogos = async () => {\r\n  try {\r\n    console.log('Obteniendo catálogos...');\r\n    \r\n    // Función auxiliar para ejecutar consultas con fallback\r\n    const executeWithFallback = async (query: string, fallback: any[] = []) => {\r\n      try {\r\n        return await executeQuery(query);\r\n      } catch (error) {\r\n        console.warn(`Query failed: ${query}`, error);\r\n        return fallback;\r\n      }\r\n    };\r\n\r\n    // Obtener catálogos básicos que probablemente existan\r\n    const usuarios = await executeWithFallback('SELECT * FROM usuarios', []);\r\n    \r\n    // Para tipos de equipo, intentar múltiples variantes\r\n    const tiposEquipo = await executeWithFallback('SELECT * FROM tipoequipo', []);\r\n    \r\n    // Para estatus, intentar múltiples variantes  \r\n    const estatusEquipos = await executeWithFallback('SELECT * FROM estatusequipo', []);\r\n    \r\n    // Para posiciones, usar valores por defecto si no existe\r\n    const posiciones = await executeWithFallback('SELECT * FROM posiciones', [\r\n      { id: 1, nombre: 'Entrada Principal' },\r\n      { id: 2, nombre: 'Recepción' },\r\n      { id: 3, nombre: 'Oficina' }\r\n    ]);\r\n\r\n    // Para sucursales, intentar obtener de la tabla de equipos o crear por defecto\r\n    const sucursales = await executeWithFallback('SELECT DISTINCT SucursalActual as nombre, SucursalActual as id FROM equipos WHERE SucursalActual IS NOT NULL AND SucursalActual != \"\"', [\r\n      { id: 'SUC001', nombre: 'Sucursal Principal' },\r\n      { id: 'SUC002', nombre: 'Sucursal Norte' },\r\n      { id: 'SUC003', nombre: 'Sucursal Sur' }\r\n    ]);\r\n\r\n    return {\r\n      tiposEquipo,\r\n      estatusEquipos,\r\n      usuarios,\r\n      posiciones,\r\n      sucursales,\r\n      // Catálogos adicionales vacíos por ahora\r\n      estados: [],\r\n      municipios: [],\r\n      zonas: []\r\n    };\r\n  } catch (error) {\r\n    console.error('Error obteniendo catálogos:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const getHistorialMovimientos = async (no_serie?: string) => {\r\n  if (no_serie) {\r\n    return executeQuery('SELECT * FROM VistaHistorialMovimientos WHERE no_serie = ? ORDER BY fecha DESC', [no_serie]);\r\n  }\r\n  return executeQuery('SELECT * FROM VistaHistorialMovimientos ORDER BY fecha DESC LIMIT 100');\r\n};\r\n\r\nexport default pool;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danie/OneDrive/Documentos/GostCAM/GostCAM%20-%20Frontend/src/app/api/equipos/%5Bno_serie%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { executeQuery } from \"@/lib/database\";\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ no_serie: string }> }\n) {\n  try {\n    const { no_serie } = await params;\n\n    if (!no_serie) {\n      return NextResponse.json({\n        success: false,\n        error: 'Número de serie es requerido'\n      }, { status: 400 });\n    }\n\n    // Consulta para obtener detalles del equipo (solo activos)\n    const equipoQuery = `\n      SELECT \n        e.no_serie,\n        e.nombreEquipo,\n        e.modelo,\n        e.numeroActivo,\n        e.fechaAlta,\n        te.nombreTipo AS TipoEquipo,\n        ee.estatus AS EstatusEquipo,\n        u.NombreUsuario AS UsuarioAsignado,\n        DATEDIFF(CURDATE(), e.fechaAlta) AS diasEnSistema\n      FROM equipo e\n      LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo\n      LEFT JOIN estatusequipo ee ON e.idEstatus = ee.idEstatus\n      LEFT JOIN usuarios u ON e.idUsuarios = u.idUsuarios\n      WHERE e.no_serie = ? AND (e.eliminado = 0 OR e.eliminado IS NULL)\n    `;\n\n    const equipoResult = await executeQuery(equipoQuery, [no_serie]);\n\n    if (equipoResult.length === 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'Equipo no encontrado'\n      }, { status: 404 });\n    }\n\n    const equipo = equipoResult[0] as any;\n\n    const response = {\n      equipo: {\n        ...equipo,\n        fechaAlta: new Date(equipo.fechaAlta).toISOString(),\n        SucursalActual: 'Centro Principal',\n        AreaActual: 'Área Principal',\n        DescripcionArea: 'Sin descripción',\n        ZonaSucursal: 'CDMX',\n        EstadoSucursal: 'Ciudad de México',\n        MunicipioSucursal: 'Benito Juárez',\n        CorreoUsuario: 'usuario@correo.com'\n      },\n      historial: [],\n      estadisticas: {\n        totalMovimientos: 0,\n        totalTraslados: 0,\n        totalMantenimientos: 0,\n        totalReparaciones: 0,\n        movimientosAbiertos: 0,\n        promedioDiasMovimiento: 0,\n        ultimoMovimiento: null\n      },\n      equiposSimilares: [],\n      metadatos: {\n        consultadoEn: new Date().toISOString(),\n        totalRegistros: {\n          movimientos: 0,\n          equiposSimilares: 0\n        }\n      }\n    };\n\n    return NextResponse.json({\n      success: true,\n      data: response,\n      message: 'Detalles del equipo obtenidos exitosamente'\n    }, { status: 200 });\n\n  } catch (error) {\n    console.error('Error obteniendo detalles del equipo:', error);\n    return NextResponse.json({\n      success: false,\n      error: 'Error interno del servidor',\n      details: error instanceof Error ? error.message : 'Error desconocido'\n    }, { status: 500 });\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ no_serie: string }> }\n) {\n  try {\n    const { no_serie } = await params;\n    const body = await request.json();\n\n    console.log('PUT equipo:', no_serie, body);\n\n    if (!no_serie) {\n      return NextResponse.json({\n        success: false,\n        error: 'Número de serie es requerido'\n      }, { status: 400 });\n    }\n\n    // Validar que el equipo existe - TODO: agregar filtro eliminados\n    const existeQuery = `SELECT no_serie FROM equipo WHERE no_serie = ?`;\n    const existeResult = await executeQuery(existeQuery, [no_serie]);\n\n    if (existeResult.length === 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'Equipo no encontrado'\n      }, { status: 404 });\n    }\n\n    // Construir la consulta de actualización dinámicamente\n    const campos = [];\n    const valores = [];\n\n    if (body.nombreEquipo !== undefined) {\n      campos.push('nombreEquipo = ?');\n      valores.push(body.nombreEquipo);\n    }\n    if (body.modelo !== undefined) {\n      campos.push('modelo = ?');\n      valores.push(body.modelo);\n    }\n    if (body.numeroActivo !== undefined) {\n      campos.push('numeroActivo = ?');\n      valores.push(body.numeroActivo);\n    }\n    if (body.idTipoEquipo !== undefined && body.idTipoEquipo !== '' && body.idTipoEquipo !== null) {\n      campos.push('idTipoEquipo = ?');\n      valores.push(parseInt(body.idTipoEquipo) || null);\n    }\n    if (body.idEstatus !== undefined && body.idEstatus !== '' && body.idEstatus !== null) {\n      campos.push('idEstatus = ?');\n      valores.push(parseInt(body.idEstatus) || null);\n    }\n    if (body.idUsuarios !== undefined && body.idUsuarios !== '' && body.idUsuarios !== null) {\n      campos.push('idUsuarios = ?');\n      valores.push(parseInt(body.idUsuarios) || null);\n    }\n    if (body.idPosicion !== undefined && body.idPosicion !== '' && body.idPosicion !== null) {\n      campos.push('idPosicion = ?');\n      valores.push(parseInt(body.idPosicion) || null);\n    }\n\n    if (campos.length === 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'No se proporcionaron campos para actualizar'\n      }, { status: 400 });\n    }\n\n    // Agregar el parámetro no_serie al final para la cláusula WHERE\n    valores.push(no_serie);\n\n    const updateQuery = `\n      UPDATE equipo \n      SET ${campos.join(', ')} \n      WHERE no_serie = ?\n    `;\n\n    console.log('Update query:', updateQuery);\n    console.log('Update valores:', valores);\n\n    await executeQuery(updateQuery, valores);\n\n    // Obtener el equipo actualizado - TODO: agregar filtro eliminados\n    const equipoQuery = `\n      SELECT \n        e.no_serie,\n        e.nombreEquipo,\n        e.modelo,\n        e.numeroActivo,\n        e.fechaAlta,\n        te.nombreTipo AS TipoEquipo,\n        ee.estatus AS EstatusEquipo,\n        u.NombreUsuario AS UsuarioAsignado,\n        DATEDIFF(CURDATE(), e.fechaAlta) AS diasEnSistema\n      FROM equipo e\n      LEFT JOIN tipoequipo te ON e.idTipoEquipo = te.idTipoEquipo\n      LEFT JOIN estatusequipo ee ON e.idEstatus = ee.idEstatus\n      LEFT JOIN usuarios u ON e.idUsuarios = u.idUsuarios\n      WHERE e.no_serie = ?\n    `;\n\n    const equipoActualizado = await executeQuery(equipoQuery, [no_serie]);\n\n    return NextResponse.json({\n      success: true,\n      data: equipoActualizado[0],\n      message: 'Equipo actualizado exitosamente'\n    }, { status: 200 });\n\n  } catch (error) {\n    console.error('Error actualizando equipo:', error);\n    return NextResponse.json({\n      success: false,\n      error: 'Error interno del servidor',\n      details: error instanceof Error ? error.message : 'Error desconocido'\n    }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ no_serie: string }> }\n) {\n  try {\n    const { no_serie } = await params;\n\n    console.log('DELETE (Lógico) equipo:', no_serie);\n\n    if (!no_serie) {\n      return NextResponse.json({\n        success: false,\n        error: 'Número de serie es requerido'\n      }, { status: 400 });\n    }\n\n    // Verificar que el equipo existe y no está ya eliminado\n    const existeQuery = `\n      SELECT no_serie, nombreEquipo, eliminado\n      FROM equipo \n      WHERE no_serie = ?\n    `;\n    const existeResult = await executeQuery(existeQuery, [no_serie]);\n\n    if (existeResult.length === 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'Equipo no encontrado'\n      }, { status: 404 });\n    }\n\n    const equipo = existeResult[0] as any;\n\n    if (equipo.eliminado === 1) {\n      return NextResponse.json({\n        success: false,\n        error: 'El equipo ya está eliminado'\n      }, { status: 400 });\n    }\n\n    // ✅ ELIMINACIÓN LÓGICA: Marcar como eliminado sin borrar el registro\n    const deleteQuery = `\n      UPDATE equipo \n      SET \n        eliminado = 1,\n        fechaEliminacion = NOW(),\n        usuarioEliminacion = 'Sistema'\n      WHERE no_serie = ? AND eliminado = 0\n    `;\n    const result = await executeQuery(deleteQuery, [no_serie]);\n\n    if ((result as any).affectedRows === 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'No se pudo eliminar el equipo'\n      }, { status: 500 });\n    }\n\n    console.log('✅ Equipo eliminado lógicamente:', no_serie);\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        no_serie: equipo.no_serie,\n        nombreEquipo: equipo.nombreEquipo,\n        tipoEliminacion: 'lógica',\n        fechaEliminacion: new Date().toISOString(),\n        conservadoEnBD: true\n      },\n      message: 'Equipo eliminado exitosamente (el registro se conserva en la base de datos)'\n    }, { status: 200 });\n\n  } catch (error) {\n    console.error('Error eliminando equipo lógicamente:', error);\n    return NextResponse.json({\n      success: false,\n      error: 'Error interno del servidor',\n      details: error instanceof Error ? error.message : 'Error desconocido'\n    }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}